package utils;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

/**
 * Clase que se encarga de resumir el contenido de un fichero de texto
 */
public class ResumeFichero {

	/** Fichero a resumir */
	private String fichero;

	/** Algoritmo utilizado para el resumen */
	private String algoritmo;

	/**
	 * @param fichero
	 * @param algoritmo
	 */
	public ResumeFichero(String fichero, String algoritmo) {

		setFichero(fichero);
		setAlgoritmo(algoritmo);

	}

	/**
	 * Resume la cadena proveniente de un fichero de texto
	 * 
	 * @return la cadena resumida sin may√∫sculas
	 */
	public String getContenidoReducido() {

		StringBuilder builder = null;
		String contenido = getContenidoFichero();

		try {

			// Objeto MessageDirect con el algoritmo especificado
			MessageDigest md = MessageDigest.getInstance(algoritmo);

			// Actualizar el objeto con el contenido a resumir
			md.update(contenido.getBytes());

			// Resumir el contenido
			byte[] digest = md.digest();

			// Builder para construir la cadena
			builder = new StringBuilder();

			// Recorrer el resumen en bytes y convertirlo en hexadecimal
			for (byte b : digest) {
				builder.append(String.format("%02x", b));
			}

		} catch (NoSuchAlgorithmException e) {

			e.printStackTrace();

		}

		return builder.toString().toLowerCase();

	}

	/**
	 * Saca el contenido de un fichero a una cadena
	 * 
	 * @return el String con el contenido del fichero
	 */
	private byte[] getContenidoFichero() {

		Path ruta = Path.of(fichero);

		try {

			byte[] contenido = Files.readAllBytes(ruta);

		} catch (IOException e) {

			e.printStackTrace();

		}

		return null;
	}

	/**
	 * Cierra los readers
	 * 
	 * @param reader
	 * @param buffer
	 */
	private void closeReaders(FileReader reader, BufferedReader buffer) {
		try {
			reader.close();
			buffer.close();
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	/**
	 * @return the fichero
	 */
	public String getFichero() {
		return fichero;
	}

	/**
	 * @param fichero the fichero to set
	 */
	public void setFichero(String fichero) {
		this.fichero = fichero;
	}

	/**
	 * @return the algoritmo
	 */
	public String getAlgoritmo() {
		return algoritmo;
	}

	/**
	 * @param algoritmo the algoritmo to set
	 */
	public void setAlgoritmo(String algoritmo) {
		this.algoritmo = algoritmo;
	}

}
